#pragma once

#include <cstdint>

#include "../../../basicDeviceClasses/displayProcessor.hpp"
#include "../../../basicDeviceClasses/signaledDevice.hpp"
#include "../../sockets/processors/B3050/b3050.hpp"
#include "../../../scheduler/scheduler.hpp"

class alignas(64) V1000 : public B3050, public displayProcessor {
    // VRAM memory map
    const static uint16_t VRAM_BASE = 0x1000;
    const static uint16_t TM_OFFSET = 0x0000;
    const static uint16_t PT_OFFSET = 0x0800;
    // Cartridge memory map
    const static uint16_t TT0_BASE = 0x4000;
    const static uint16_t TT1_BASE = 0x5000;
    // Internal memory map
    const static uint8_t BP_OFFSET = 0x00;
    const static uint8_t SP_OFFSET = 0x20;
    const static uint8_t AS_OFFSET = 0x40;
    const static uint8_t ST_OFFSET = 0x60;
    // Display constants
    const static uint64_t PIXELS_PER_SCANLINE         = 256;
    const static uint64_t REAL_PIXELS_PER_SCANLINE    = PIXELS_PER_SCANLINE * 3;
    const static uint64_t BYTES_PER_SCANLINE          = REAL_PIXELS_PER_SCANLINE * 4;
    const static uint64_t VISIBLE_SCANLINES_PER_FRAME = 240;
    const static uint64_t SCANLINES_PER_FRAME         = 262;
    const static uint64_t TICKS_PER_SCANLINE_VISIBLE  = 108 * 450;
    const static uint64_t TICKS_PER_SCANLINE_HBLANK   = 108 * 150;
    const static uint64_t TICKS_PER_SCANLINE          = TICKS_PER_SCANLINE_VISIBLE + TICKS_PER_SCANLINE_HBLANK;
    // const static uint64_t TICKS_PER_PIXEL             = 216;
private:
    static inline struct {
        uint8_t r, g, b;
    } displayColors[512] = {
        {0xff, 0xff, 0xff},
        {0x7f, 0x7f, 0xff},
        {0x7f, 0xff, 0x7f},
        {0x7f, 0xff, 0xff},
        {0xff, 0x7f, 0x7f},
        {0xff, 0x7f, 0xff},
        {0xff, 0xff, 0x7f},
        {0x7f, 0x7f, 0x7f},
        {0xff, 0xb3, 0xb3},
        {0x7f, 0x59, 0xb3},
        {0x7f, 0xb3, 0x59},
        {0x7f, 0xb3, 0xb3},
        {0xff, 0x59, 0x59},
        {0xff, 0x59, 0xb3},
        {0xff, 0xb3, 0x59},
        {0x7f, 0x59, 0x59},
        {0xff, 0xe0, 0xb3},
        {0x7f, 0x70, 0xb3},
        {0x7f, 0xe0, 0x59},
        {0x7f, 0xe0, 0xb3},
        {0xff, 0x70, 0x59},
        {0xff, 0x70, 0xb3},
        {0xff, 0xe0, 0x59},
        {0x7f, 0x70, 0x59},
        {0xff, 0xf8, 0xb3},
        {0x7f, 0x7c, 0xb3},
        {0x7f, 0xf8, 0x59},
        {0x7f, 0xf8, 0xb3},
        {0xff, 0x7c, 0x59},
        {0xff, 0x7c, 0xb3},
        {0xff, 0xf8, 0x59},
        {0x7f, 0x7c, 0x59},
        {0xc2, 0xff, 0xb3},
        {0x61, 0x7f, 0xb3},
        {0x61, 0xff, 0x59},
        {0x61, 0xff, 0xb3},
        {0xc2, 0x7f, 0x59},
        {0xc2, 0x7f, 0xb3},
        {0xc2, 0xff, 0x59},
        {0x61, 0x7f, 0x59},
        {0xb3, 0xff, 0xd1},
        {0x59, 0x7f, 0xd1},
        {0x59, 0xff, 0x68},
        {0x59, 0xff, 0xd1},
        {0xb3, 0x7f, 0x68},
        {0xb3, 0x7f, 0xd1},
        {0xb3, 0xff, 0x68},
        {0x59, 0x7f, 0x68},
        {0xb3, 0xff, 0xff},
        {0x59, 0x7f, 0xff},
        {0x59, 0xff, 0x7f},
        {0x59, 0xff, 0xff},
        {0xb3, 0x7f, 0x7f},
        {0xb3, 0x7f, 0xff},
        {0xb3, 0xff, 0x7f},
        {0x59, 0x7f, 0x7f},
        {0xb3, 0xd1, 0xff},
        {0x59, 0x68, 0xff},
        {0x59, 0xd1, 0x7f},
        {0x59, 0xd1, 0xff},
        {0xb3, 0x68, 0x7f},
        {0xb3, 0x68, 0xff},
        {0xb3, 0xd1, 0x7f},
        {0x59, 0x68, 0x7f},
        {0xb9, 0xc5, 0xff},
        {0x5c, 0x62, 0xff},
        {0x5c, 0xc5, 0x7f},
        {0x5c, 0xc5, 0xff},
        {0xb9, 0x62, 0x7f},
        {0xb9, 0x62, 0xff},
        {0xb9, 0xc5, 0x7f},
        {0x5c, 0x62, 0x7f},
        {0xf0, 0xb3, 0xff},
        {0x78, 0x59, 0xff},
        {0x78, 0xb3, 0x7f},
        {0x78, 0xb3, 0xff},
        {0xf0, 0x59, 0x7f},
        {0xf0, 0x59, 0xff},
        {0xf0, 0xb3, 0x7f},
        {0x78, 0x59, 0x7f},
        {0xff, 0xb3, 0xe1},
        {0x7f, 0x59, 0xe1},
        {0x7f, 0xb3, 0x70},
        {0x7f, 0xb3, 0xe1},
        {0xff, 0x59, 0x70},
        {0xff, 0x59, 0xe1},
        {0xff, 0xb3, 0x70},
        {0x7f, 0x59, 0x70},
        {0xbf, 0xbf, 0xbf},
        {0x5f, 0x5f, 0xbf},
        {0x5f, 0xbf, 0x5f},
        {0x5f, 0xbf, 0xbf},
        {0xbf, 0x5f, 0x5f},
        {0xbf, 0x5f, 0xbf},
        {0xbf, 0xbf, 0x5f},
        {0x5f, 0x5f, 0x5f},
        {0xff, 0x66, 0x66},
        {0x7f, 0x33, 0x66},
        {0x7f, 0x66, 0x33},
        {0x7f, 0x66, 0x66},
        {0xff, 0x33, 0x33},
        {0xff, 0x33, 0x66},
        {0xff, 0x66, 0x33},
        {0x7f, 0x33, 0x33},
        {0xff, 0xc2, 0x66},
        {0x7f, 0x61, 0x66},
        {0x7f, 0xc2, 0x33},
        {0x7f, 0xc2, 0x66},
        {0xff, 0x61, 0x33},
        {0xff, 0x61, 0x66},
        {0xff, 0xc2, 0x33},
        {0x7f, 0x61, 0x33},
        {0xff, 0xf0, 0x66},
        {0x7f, 0x78, 0x66},
        {0x7f, 0xf0, 0x33},
        {0x7f, 0xf0, 0x66},
        {0xff, 0x78, 0x33},
        {0xff, 0x78, 0x66},
        {0xff, 0xf0, 0x33},
        {0x7f, 0x78, 0x33},
        {0x84, 0xff, 0x66},
        {0x42, 0x7f, 0x66},
        {0x42, 0xff, 0x33},
        {0x42, 0xff, 0x66},
        {0x84, 0x7f, 0x33},
        {0x84, 0x7f, 0x66},
        {0x84, 0xff, 0x33},
        {0x42, 0x7f, 0x33},
        {0x66, 0xff, 0xa3},
        {0x33, 0x7f, 0xa3},
        {0x33, 0xff, 0x51},
        {0x33, 0xff, 0xa3},
        {0x66, 0x7f, 0x51},
        {0x66, 0x7f, 0xa3},
        {0x66, 0xff, 0x51},
        {0x33, 0x7f, 0x51},
        {0x66, 0xff, 0xff},
        {0x33, 0x7f, 0xff},
        {0x33, 0xff, 0x7f},
        {0x33, 0xff, 0xff},
        {0x66, 0x7f, 0x7f},
        {0x66, 0x7f, 0xff},
        {0x66, 0xff, 0x7f},
        {0x33, 0x7f, 0x7f},
        {0x66, 0xa4, 0xff},
        {0x33, 0x52, 0xff},
        {0x33, 0xa4, 0x7f},
        {0x33, 0xa4, 0xff},
        {0x66, 0x52, 0x7f},
        {0x66, 0x52, 0xff},
        {0x66, 0xa4, 0x7f},
        {0x33, 0x52, 0x7f},
        {0x84, 0x66, 0xff},
        {0x42, 0x33, 0xff},
        {0x42, 0x66, 0x7f},
        {0x42, 0x66, 0xff},
        {0x84, 0x33, 0x7f},
        {0x84, 0x33, 0xff},
        {0x84, 0x66, 0x7f},
        {0x42, 0x33, 0x7f},
        {0xe1, 0x66, 0xff},
        {0x70, 0x33, 0xff},
        {0x70, 0x66, 0x7f},
        {0x70, 0x66, 0xff},
        {0xe1, 0x33, 0x7f},
        {0xe1, 0x33, 0xff},
        {0xe1, 0x66, 0x7f},
        {0x70, 0x33, 0x7f},
        {0xff, 0x66, 0xc3},
        {0x7f, 0x33, 0xc3},
        {0x7f, 0x66, 0x61},
        {0x7f, 0x66, 0xc3},
        {0xff, 0x33, 0x61},
        {0xff, 0x33, 0xc3},
        {0xff, 0x66, 0x61},
        {0x7f, 0x33, 0x61},
        {0x40, 0x40, 0x40},
        {0x20, 0x20, 0x40},
        {0x20, 0x40, 0x20},
        {0x20, 0x40, 0x40},
        {0x40, 0x20, 0x20},
        {0x40, 0x20, 0x40},
        {0x40, 0x40, 0x20},
        {0x20, 0x20, 0x20},
        {0xff, 0x1a, 0x1a},
        {0x7f, 0x0d, 0x1a},
        {0x7f, 0x1a, 0x0d},
        {0x7f, 0x1a, 0x1a},
        {0xff, 0x0d, 0x0d},
        {0xff, 0x0d, 0x1a},
        {0xff, 0x1a, 0x0d},
        {0x7f, 0x0d, 0x0d},
        {0xff, 0xa3, 0x1a},
        {0x7f, 0x51, 0x1a},
        {0x7f, 0xa3, 0x0d},
        {0x7f, 0xa3, 0x1a},
        {0xff, 0x51, 0x0d},
        {0xff, 0x51, 0x1a},
        {0xff, 0xa3, 0x0d},
        {0x7f, 0x51, 0x0d},
        {0xff, 0xe9, 0x1a},
        {0x7f, 0x74, 0x1a},
        {0x7f, 0xe9, 0x0d},
        {0x7f, 0xe9, 0x1a},
        {0xff, 0x74, 0x0d},
        {0xff, 0x74, 0x1a},
        {0xff, 0xe9, 0x0d},
        {0x7f, 0x74, 0x0d},
        {0x47, 0xff, 0x1a},
        {0x23, 0x7f, 0x1a},
        {0x23, 0xff, 0x0d},
        {0x23, 0xff, 0x1a},
        {0x47, 0x7f, 0x0d},
        {0x47, 0x7f, 0x1a},
        {0x47, 0xff, 0x0d},
        {0x23, 0x7f, 0x0d},
        {0x1a, 0xff, 0x76},
        {0x0d, 0x7f, 0x76},
        {0x0d, 0xff, 0x3b},
        {0x0d, 0xff, 0x76},
        {0x1a, 0x7f, 0x3b},
        {0x1a, 0x7f, 0x76},
        {0x1a, 0xff, 0x3b},
        {0x0d, 0x7f, 0x3b},
        {0x1a, 0xff, 0xff},
        {0x0d, 0x7f, 0xff},
        {0x0d, 0xff, 0x7f},
        {0x0d, 0xff, 0xff},
        {0x1a, 0x7f, 0x7f},
        {0x1a, 0x7f, 0xff},
        {0x1a, 0xff, 0x7f},
        {0x0d, 0x7f, 0x7f},
        {0x1a, 0x76, 0xff},
        {0x0d, 0x3b, 0xff},
        {0x0d, 0x76, 0x7f},
        {0x0d, 0x76, 0xff},
        {0x1a, 0x3b, 0x7f},
        {0x1a, 0x3b, 0xff},
        {0x1a, 0x76, 0x7f},
        {0x0d, 0x3b, 0x7f},
        {0x46, 0x1a, 0xff},
        {0x23, 0x0d, 0xff},
        {0x23, 0x1a, 0x7f},
        {0x23, 0x1a, 0xff},
        {0x46, 0x0d, 0x7f},
        {0x46, 0x0d, 0xff},
        {0x46, 0x1a, 0x7f},
        {0x23, 0x0d, 0x7f},
        {0xd2, 0x1a, 0xff},
        {0x69, 0x0d, 0xff},
        {0x69, 0x1a, 0x7f},
        {0x69, 0x1a, 0xff},
        {0xd2, 0x0d, 0x7f},
        {0xd2, 0x0d, 0xff},
        {0xd2, 0x1a, 0x7f},
        {0x69, 0x0d, 0x7f},
        {0xff, 0x1a, 0xa5},
        {0x7f, 0x0d, 0xa5},
        {0x7f, 0x1a, 0x52},
        {0x7f, 0x1a, 0xa5},
        {0xff, 0x0d, 0x52},
        {0xff, 0x0d, 0xa5},
        {0xff, 0x1a, 0x52},
        {0x7f, 0x0d, 0x52},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00},
        {0xcc, 0x00, 0x00},
        {0x66, 0x00, 0x00},
        {0x66, 0x00, 0x00},
        {0x66, 0x00, 0x00},
        {0xcc, 0x00, 0x00},
        {0xcc, 0x00, 0x00},
        {0xcc, 0x00, 0x00},
        {0x66, 0x00, 0x00},
        {0xcc, 0x7a, 0x00},
        {0x66, 0x3d, 0x00},
        {0x66, 0x7a, 0x00},
        {0x66, 0x7a, 0x00},
        {0xcc, 0x3d, 0x00},
        {0xcc, 0x3d, 0x00},
        {0xcc, 0x7a, 0x00},
        {0x66, 0x3d, 0x00},
        {0xcc, 0xb8, 0x00},
        {0x66, 0x5c, 0x00},
        {0x66, 0xb8, 0x00},
        {0x66, 0xb8, 0x00},
        {0xcc, 0x5c, 0x00},
        {0xcc, 0x5c, 0x00},
        {0xcc, 0xb8, 0x00},
        {0x66, 0x5c, 0x00},
        {0x28, 0xcc, 0x00},
        {0x14, 0x66, 0x00},
        {0x14, 0xcc, 0x00},
        {0x14, 0xcc, 0x00},
        {0x28, 0x66, 0x00},
        {0x28, 0x66, 0x00},
        {0x28, 0xcc, 0x00},
        {0x14, 0x66, 0x00},
        {0x00, 0xcc, 0x52},
        {0x00, 0x66, 0x52},
        {0x00, 0xcc, 0x29},
        {0x00, 0xcc, 0x52},
        {0x00, 0x66, 0x29},
        {0x00, 0x66, 0x52},
        {0x00, 0xcc, 0x29},
        {0x00, 0x66, 0x29},
        {0x00, 0xcc, 0xcc},
        {0x00, 0x66, 0xcc},
        {0x00, 0xcc, 0x66},
        {0x00, 0xcc, 0xcc},
        {0x00, 0x66, 0x66},
        {0x00, 0x66, 0xcc},
        {0x00, 0xcc, 0x66},
        {0x00, 0x66, 0x66},
        {0x00, 0x52, 0xcc},
        {0x00, 0x29, 0xcc},
        {0x00, 0x52, 0x66},
        {0x00, 0x52, 0xcc},
        {0x00, 0x29, 0x66},
        {0x00, 0x29, 0xcc},
        {0x00, 0x52, 0x66},
        {0x00, 0x29, 0x66},
        {0x28, 0x00, 0xcc},
        {0x14, 0x00, 0xcc},
        {0x14, 0x00, 0x66},
        {0x14, 0x00, 0xcc},
        {0x28, 0x00, 0x66},
        {0x28, 0x00, 0xcc},
        {0x28, 0x00, 0x66},
        {0x14, 0x00, 0x66},
        {0xa4, 0x00, 0xcc},
        {0x52, 0x00, 0xcc},
        {0x52, 0x00, 0x66},
        {0x52, 0x00, 0xcc},
        {0xa4, 0x00, 0x66},
        {0xa4, 0x00, 0xcc},
        {0xa4, 0x00, 0x66},
        {0x52, 0x00, 0x66},
        {0xcc, 0x00, 0x7c},
        {0x66, 0x00, 0x7c},
        {0x66, 0x00, 0x3e},
        {0x66, 0x00, 0x7c},
        {0xcc, 0x00, 0x3e},
        {0xcc, 0x00, 0x7c},
        {0xcc, 0x00, 0x3e},
        {0x66, 0x00, 0x3e},
        {0x80, 0x00, 0x00},
        {0x40, 0x00, 0x00},
        {0x40, 0x00, 0x00},
        {0x40, 0x00, 0x00},
        {0x80, 0x00, 0x00},
        {0x80, 0x00, 0x00},
        {0x80, 0x00, 0x00},
        {0x40, 0x00, 0x00},
        {0x80, 0x4c, 0x00},
        {0x40, 0x26, 0x00},
        {0x40, 0x4c, 0x00},
        {0x40, 0x4c, 0x00},
        {0x80, 0x26, 0x00},
        {0x80, 0x26, 0x00},
        {0x80, 0x4c, 0x00},
        {0x40, 0x26, 0x00},
        {0x80, 0x73, 0x00},
        {0x40, 0x39, 0x00},
        {0x40, 0x73, 0x00},
        {0x40, 0x73, 0x00},
        {0x80, 0x39, 0x00},
        {0x80, 0x39, 0x00},
        {0x80, 0x73, 0x00},
        {0x40, 0x39, 0x00},
        {0x19, 0x80, 0x00},
        {0x0c, 0x40, 0x00},
        {0x0c, 0x80, 0x00},
        {0x0c, 0x80, 0x00},
        {0x19, 0x40, 0x00},
        {0x19, 0x40, 0x00},
        {0x19, 0x80, 0x00},
        {0x0c, 0x40, 0x00},
        {0x00, 0x80, 0x33},
        {0x00, 0x40, 0x33},
        {0x00, 0x80, 0x19},
        {0x00, 0x80, 0x33},
        {0x00, 0x40, 0x19},
        {0x00, 0x40, 0x33},
        {0x00, 0x80, 0x19},
        {0x00, 0x40, 0x19},
        {0x00, 0x80, 0x7f},
        {0x00, 0x40, 0x7f},
        {0x00, 0x80, 0x3f},
        {0x00, 0x80, 0x7f},
        {0x00, 0x40, 0x3f},
        {0x00, 0x40, 0x7f},
        {0x00, 0x80, 0x3f},
        {0x00, 0x40, 0x3f},
        {0x00, 0x33, 0x80},
        {0x00, 0x19, 0x80},
        {0x00, 0x33, 0x40},
        {0x00, 0x33, 0x80},
        {0x00, 0x19, 0x40},
        {0x00, 0x19, 0x80},
        {0x00, 0x33, 0x40},
        {0x00, 0x19, 0x40},
        {0x19, 0x00, 0x80},
        {0x0c, 0x00, 0x80},
        {0x0c, 0x00, 0x40},
        {0x0c, 0x00, 0x80},
        {0x19, 0x00, 0x40},
        {0x19, 0x00, 0x80},
        {0x19, 0x00, 0x40},
        {0x0c, 0x00, 0x40},
        {0x67, 0x00, 0x80},
        {0x33, 0x00, 0x80},
        {0x33, 0x00, 0x40},
        {0x33, 0x00, 0x80},
        {0x67, 0x00, 0x40},
        {0x67, 0x00, 0x80},
        {0x67, 0x00, 0x40},
        {0x33, 0x00, 0x40},
        {0x80, 0x00, 0x4e},
        {0x40, 0x00, 0x4e},
        {0x40, 0x00, 0x27},
        {0x40, 0x00, 0x4e},
        {0x80, 0x00, 0x27},
        {0x80, 0x00, 0x4e},
        {0x80, 0x00, 0x27},
        {0x40, 0x00, 0x27},
        {0x33, 0x00, 0x00},
        {0x19, 0x00, 0x00},
        {0x19, 0x00, 0x00},
        {0x19, 0x00, 0x00},
        {0x33, 0x00, 0x00},
        {0x33, 0x00, 0x00},
        {0x33, 0x00, 0x00},
        {0x19, 0x00, 0x00},
        {0x33, 0x1f, 0x00},
        {0x19, 0x0f, 0x00},
        {0x19, 0x1f, 0x00},
        {0x19, 0x1f, 0x00},
        {0x33, 0x0f, 0x00},
        {0x33, 0x0f, 0x00},
        {0x33, 0x1f, 0x00},
        {0x19, 0x0f, 0x00},
        {0x33, 0x2e, 0x00},
        {0x19, 0x17, 0x00},
        {0x19, 0x2e, 0x00},
        {0x19, 0x2e, 0x00},
        {0x33, 0x17, 0x00},
        {0x33, 0x17, 0x00},
        {0x33, 0x2e, 0x00},
        {0x19, 0x17, 0x00},
        {0x0a, 0x33, 0x00},
        {0x05, 0x19, 0x00},
        {0x05, 0x33, 0x00},
        {0x05, 0x33, 0x00},
        {0x0a, 0x19, 0x00},
        {0x0a, 0x19, 0x00},
        {0x0a, 0x33, 0x00},
        {0x05, 0x19, 0x00},
        {0x00, 0x33, 0x14},
        {0x00, 0x19, 0x14},
        {0x00, 0x33, 0x0a},
        {0x00, 0x33, 0x14},
        {0x00, 0x19, 0x0a},
        {0x00, 0x19, 0x14},
        {0x00, 0x33, 0x0a},
        {0x00, 0x19, 0x0a},
        {0x00, 0x33, 0x33},
        {0x00, 0x19, 0x33},
        {0x00, 0x33, 0x19},
        {0x00, 0x33, 0x33},
        {0x00, 0x19, 0x19},
        {0x00, 0x19, 0x33},
        {0x00, 0x33, 0x19},
        {0x00, 0x19, 0x19},
        {0x00, 0x15, 0x33},
        {0x00, 0x0a, 0x33},
        {0x00, 0x15, 0x19},
        {0x00, 0x15, 0x33},
        {0x00, 0x0a, 0x19},
        {0x00, 0x0a, 0x33},
        {0x00, 0x15, 0x19},
        {0x00, 0x0a, 0x19},
        {0x0a, 0x00, 0x33},
        {0x05, 0x00, 0x33},
        {0x05, 0x00, 0x19},
        {0x05, 0x00, 0x33},
        {0x0a, 0x00, 0x19},
        {0x0a, 0x00, 0x33},
        {0x0a, 0x00, 0x19},
        {0x05, 0x00, 0x19},
        {0x29, 0x00, 0x33},
        {0x14, 0x00, 0x33},
        {0x14, 0x00, 0x19},
        {0x14, 0x00, 0x33},
        {0x29, 0x00, 0x19},
        {0x29, 0x00, 0x33},
        {0x29, 0x00, 0x19},
        {0x14, 0x00, 0x19},
        {0x33, 0x00, 0x1f},
        {0x19, 0x00, 0x1f},
        {0x19, 0x00, 0x0f},
        {0x19, 0x00, 0x1f},
        {0x33, 0x00, 0x0f},
        {0x33, 0x00, 0x1f},
        {0x33, 0x00, 0x0f},
        {0x19, 0x00, 0x0f},
    };
    uint32_t *scanlineBuffer;
    uint8_t   pixelPaletteIndexes[33 * 8] {};
public:
    struct {
        struct {
            uint8_t x;
            uint8_t y;
        } pixel, tile;
        // i_s_bRGB
        // |||| | +--- (B) Blue emphasis
        // |||| +----- (G) Green emphasis
        // |||+------- (R) Red emphasis
        // ||+-------- (b) Background tilemap select
        // |+--------- (s) Sprite tilemap select
        // +---------- (i) Interrupt (NMI/IRQ) enable
        uint8_t ctrl;
        uint8_t mem[64 + 32 + 256];
    } real, temp;
    bool xScrollWrite = false;
    bool yScrollWrite = false;
    // uint32_t tilePixels;
    // uint16_t bgTTBase;
    // uint16_t spTTBase;
    // uint8_t  palettePairBits;
    enum flags {
        BF = 0b00000001,
        GF = 0b00000010,
        RF = 0b00000100,
        bF = 0b00001000,
        sF = 0b00100000,
        iF = 0b10000000,
    };
    V1000();
    bool     initialize(signaledDevice *sh, B2000 *d, B2100 *a, B2310 *crw, B2310 *cl, B2310 *cnmi, B2310 *cirq) override;
    uint64_t signal() override;
    uint64_t dispatchEvent(uint8_t index, uint8_t data[4]) override;
private:
    uint64_t renderScanline(uint8_t data[4]);
    uint64_t vBlank(uint8_t data[4]);
    uint64_t hBlank(uint8_t data[4]);
    // uint64_t renderPixel(uint8_t data[4]);
private:
    // void fetchPalettePairBits();
    // void fetchTilePixelRow();
    // void renderToBuffer(uint8_t scanline, uint8_t dot, uint8_t pixelPaletteIndex);
};
